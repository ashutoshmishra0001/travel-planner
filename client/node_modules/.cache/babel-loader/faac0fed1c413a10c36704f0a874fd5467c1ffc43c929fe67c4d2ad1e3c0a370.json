{"ast":null,"code":"import React,{createContext,useState,useEffect,useContext,useMemo,useCallback}from'react';import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();const getApiUrl=()=>{return process.env.REACT_APP_API_URL||'http://localhost:5000/api';};export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);useEffect(()=>{const loadUserFromStorage=()=>{try{const storedUser=localStorage.getItem('user');if(storedUser){const userData=JSON.parse(storedUser);setUser(userData);axios.defaults.headers.common['Authorization']=\"Bearer \".concat(userData.token);}}catch(error){console.error(\"Could not load user from storage\",error);localStorage.removeItem('user');}finally{setLoading(false);}};loadUserFromStorage();},[]);const login=useCallback(async(email,password)=>{const{data}=await axios.post(\"\".concat(getApiUrl(),\"/auth/login\"),{email,password});localStorage.setItem('user',JSON.stringify(data));axios.defaults.headers.common['Authorization']=\"Bearer \".concat(data.token);setUser(data);},[]);const signup=useCallback(async(username,email,password)=>{await axios.post(\"\".concat(getApiUrl(),\"/auth/register\"),{username,email,password});},[]);const logout=useCallback(()=>{localStorage.removeItem('user');delete axios.defaults.headers.common['Authorization'];setUser(null);},[]);// Memoize the context value to prevent unnecessary re-renders of consuming components\nconst value=useMemo(()=>({user,loading,login,signup,logout}),[user,loading,login,signup,logout]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:!loading&&children});};export const useAuth=()=>useContext(AuthContext);","map":{"version":3,"names":["React","createContext","useState","useEffect","useContext","useMemo","useCallback","axios","jsx","_jsx","AuthContext","getApiUrl","process","env","REACT_APP_API_URL","AuthProvider","_ref","children","user","setUser","loading","setLoading","loadUserFromStorage","storedUser","localStorage","getItem","userData","JSON","parse","defaults","headers","common","concat","token","error","console","removeItem","login","email","password","data","post","setItem","stringify","signup","username","logout","value","Provider","useAuth"],"sources":["D:/travel-planner-app/client/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect, useContext, useMemo, useCallback } from 'react';\r\nimport axios from 'axios';\r\n\r\nconst AuthContext = createContext();\r\n\r\nconst getApiUrl = () => {\r\n    return process.env.REACT_APP_API_URL || 'http://localhost:5000/api';\r\n};\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n    const [user, setUser] = useState(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        const loadUserFromStorage = () => {\r\n            try {\r\n                const storedUser = localStorage.getItem('user');\r\n                if (storedUser) {\r\n                    const userData = JSON.parse(storedUser);\r\n                    setUser(userData);\r\n                    axios.defaults.headers.common['Authorization'] = `Bearer ${userData.token}`;\r\n                }\r\n            } catch (error) {\r\n                console.error(\"Could not load user from storage\", error);\r\n                localStorage.removeItem('user');\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n        loadUserFromStorage();\r\n    }, []);\r\n\r\n    const login = useCallback(async (email, password) => {\r\n        const { data } = await axios.post(`${getApiUrl()}/auth/login`, { email, password });\r\n        localStorage.setItem('user', JSON.stringify(data));\r\n        axios.defaults.headers.common['Authorization'] = `Bearer ${data.token}`;\r\n        setUser(data);\r\n    }, []);\r\n\r\n    const signup = useCallback(async (username, email, password) => {\r\n        await axios.post(`${getApiUrl()}/auth/register`, { username, email, password });\r\n    }, []);\r\n\r\n    const logout = useCallback(() => {\r\n        localStorage.removeItem('user');\r\n        delete axios.defaults.headers.common['Authorization'];\r\n        setUser(null);\r\n    }, []);\r\n\r\n    // Memoize the context value to prevent unnecessary re-renders of consuming components\r\n    const value = useMemo(() => ({\r\n        user,\r\n        loading,\r\n        login,\r\n        signup,\r\n        logout\r\n    }), [user, loading, login, signup, logout]);\r\n\r\n    return (\r\n        <AuthContext.Provider value={value}>\r\n            {!loading && children}\r\n        </AuthContext.Provider>\r\n    );\r\n};\r\n\r\nexport const useAuth = () => useContext(AuthContext);"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}